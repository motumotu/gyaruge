//-----------------------------------------------------------
// FPSManager.cpp
// FPSの調整
// 制作日 2015.03.01
// 制作者 motumotu
//-----------------------------------------------------------
#include "FPSManager.h"

//-----------------------------------------------------------
// コンストラクタ
//-----------------------------------------------------------
FPSManager::FPSManager()
{
    init();   // 初期処理
}

//-----------------------------------------------------------
// デストラクタ
//-----------------------------------------------------------
FPSManager::~FPSManager()
{

}

//-----------------------------------------------------------
// 初期処理
//-----------------------------------------------------------
void FPSManager::init()
{
    start_time = 0;    // 開始時間
    counter = 0;       // 計測フレーム数
    fps = 0;           // 現在fps
}

//-----------------------------------------------------------
// 更新処理
//-----------------------------------------------------------
void FPSManager::update()
{
    // 開始時間
    if (counter == 0) {
        start_time = GetNowCount();
    }
    if (counter == N) {
        int t = GetNowCount();
        fps = 1000.f / ((t - start_time) / (double)N);
        counter = 0;
        start_time = t;
    }
    counter++;
}

//-----------------------------------------------------------
// 待つ
//-----------------------------------------------------------
void FPSManager::wait(){
    int took_time = GetNowCount() - start_time;         // かかった時間
    int wait_time = counter * 1000 / FPS - took_time;   // 待つべき時間
    if (wait_time > 0){
        Sleep(wait_time);	//待機
    }
}

//===========================================================
// getter
//===========================================================


